<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Manage Interview Forms</title>
    {% load static %}
    <link rel="icon" href="{% static 'form_ai/favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'form_ai/css/responses.css' %}">
</head>
<body>
    <header class="header">
        <h1>Interview Forms</h1>
        <nav class="header-actions">
            <a href="{% url 'voice_page' %}" class="control-btn">Voice Test</a>
            <button onclick="createNewForm()" class="control-btn">+ New Form</button>
        </nav>
    </header>

    <main class="layout">
        {% if forms %}
            <ul class="responses-list">
                {% for item in forms %}
                    <li class="response-container">
                        <div class="response-meta">
                            <div class="meta-row">
                                <span class="meta-label">Title:</span>
                                <span class="meta-value">{{ item.form.title }}</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">Created:</span>
                                <span class="meta-value">{{ item.form.created_at|date:"Y-m-d H:i" }}</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">Responses:</span>
                                <span class="meta-value">{{ item.completed_count }} / {{ item.response_count }}</span>
                            </div>
                        </div>

                        <div class="form-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button onclick="copyUrl('{{ item.interview_url }}')" class="control-btn">
                                ðŸ“‹ Copy Interview Link
                            </button>
                            <a href="{% url 'view_form_responses' item.form.id %}" class="control-btn">
                                View Responses ({{ item.completed_count }})
                            </a>
                        </div>

                        <div class="url-display" style="margin-top: 0.75rem; padding: 0.5rem; background: #f5f5f5; border-radius: 4px; font-size: 0.875rem; word-break: break-all;">
                            {{ item.interview_url }}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="empty-state">
                <h3 class="empty-title">No Interview Forms Yet</h3>
                <p class="empty-sub">Create your first form to start conducting interviews.</p>
                <button onclick="createNewForm()" class="control-btn" style="margin-top: 1rem;">
                    Create Form
                </button>
            </div>
        {% endif %}
    </main>

    <script>
        async function createNewForm() {
            try {
                const resp = await fetch('/forms/create/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        title: 'Internship Application',
                        expected_fields: ['name', 'qualification', 'experience']
                    })
                });
                
                if (resp.ok) {
                    location.reload();
                } else {
                    alert('Failed to create form');
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Interview link copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }
    </script>
</body>
</html>